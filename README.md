# Рекомендательный сервис

Рекомендательный сервис на базе RecTools с поддержкой LightFM для рекомендации контента пользователям.

## Архитектура

Система состоит из следующих компонентов:
- FastAPI приложение для HTTP-запросов
- gRPC сервис для высокопроизводительных запросов рекомендаций
- Планировщик задач для ежедневного обновления моделей
- Система обработки и трансформации данных из MySQL

## Требования

- Python 3.9+
- Docker и Docker Compose (для контейнерного деплоя)
- MySQL база данных (для получения данных)
- Минимум 4GB RAM для обучения моделей

## Установка

### Вариант 1: Ручная установка

1. Клонировать репозиторий:
```bash
git clone https://github.com/your-username/recomender.git
cd recomender
```

2. Настроить проект с помощью Make:
```bash
make setup
```
Эта команда создаст виртуальное окружение, установит зависимости и настроит файл .env.

3. Отредактировать файл `.env` с вашими параметрами подключения к базе данных.

4. Инициализировать структуру каталогов и обучить модель:
```bash
make init_model
```

### Вариант 2: Через Docker

1. Клонировать репозиторий:
```bash
git clone https://github.com/your-username/recomender.git
cd recomender
```

2. Создать файл `.env` на основе `.env.example` и отредактировать его.

3. Собрать и запустить контейнеры:
```bash
make docker_build
make docker_up
```

## Запуск

### Локальный запуск

Запуск API сервера:
```bash
make run_api
```

Запуск gRPC сервера:
```bash
make run_grpc
```

### Через Docker

```bash
make run
```

Просмотр логов:
```bash
make logs
```

## Использование

### HTTP API
- GET `/titles/recommendations?user_id=<id>` - получить рекомендации для пользователя
- GET `/titles/relavant?title_id=<id>` - получить похожие произведения
- GET `/rec/hot/interact?user_id=<id>&title_id=<id>&int_type=<type>&raw_score=<score>` - горячее обновление взаимодействия
- GET `/train` - запустить обучение модели
- GET `/health` - проверить статус сервиса

### gRPC API
Используйте клиент из protos/recommendations.proto для взаимодействия с gRPC сервисом.

## Обновление модели

Модель обновляется автоматически каждый день в 4:00 UTC. Для ручного запуска обновления используйте:

```bash
make train
```

## Мониторинг

Для проверки статуса сервиса используйте эндпоинт:

```bash
curl http://localhost:8000/health
```

## Устранение неполадок

1. Если модель не обучается, проверьте подключение к базе данных и логи ошибок:
```
docker-compose logs recommendation_api
```

2. При проблемах с gRPC соединением проверьте логи:
```
docker-compose logs recommendation_grpc
```

3. Для полного перезапуска сервиса:
```
make docker_down
make docker_up
```

## Команды Make

Запустите `make help` для просмотра всех доступных команд.

## Лицензия

Apache License 2.0
